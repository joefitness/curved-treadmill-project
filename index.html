<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curve Non-Motorized Treadmill Research Database</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 28px;
        }

        .description {
            color: #666;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }

        .filter-toggle {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-toggle:hover {
            background-color: #45a049;
        }

        .filter-toggle::after {
            content: 'â–¼';
            transition: transform 0.3s;
        }

        .filter-toggle.collapsed::after {
            transform: rotate(-90deg);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 6px;
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .filters.collapsed {
            max-height: 0;
            padding: 0;
            margin-bottom: 15px;
        }

        .filter-legend {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .legend-box {
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.5;
        }

        .legend-box-utility {
            background-color: #c8e6c9;
        }

        .legend-box-focus {
            background-color: #ffe0b2;
        }

        .legend-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .legend-title-utility {
            color: #2e7d32;
        }

        .legend-title-focus {
            color: #e65100;
        }

        .legend-description {
            color: #333;
            font-size: 12px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
            font-size: 14px;
        }

        input, select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .checkbox-group {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            background-color: white;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 4px 0;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            width: auto;
        }

        .checkbox-item label {
            font-weight: normal;
            margin-bottom: 0;
            cursor: pointer;
        }

        .results-info {
            margin-bottom: 20px;
            color: #666;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .study-card {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
            transition: box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .study-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .study-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background-color: transparent;
        }

        .study-card.utility::before {
            background-color: #c8e6c9;
        }

        .study-card.focus::before {
            background-color: #ffe0b2;
        }

        .treadmill-focus-badge {
            position: absolute;
            top: 12px;
            right: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            border-radius: 3px;
        }

        .treadmill-focus-badge.utility {
            background-color: #c8e6c9;
            color: #2e7d32;
        }

        .treadmill-focus-badge.focus {
            background-color: #ffe0b2;
            color: #e65100;
        }

        .study-id {
            font-size: 11px;
            color: #999;
            margin-bottom: 8px;
            font-family: monospace;
        }

        .study-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .study-authors {
            color: #555;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .study-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 12px;
            font-size: 13px;
            color: #666;
        }

        .study-meta span {
            display: flex;
            align-items: center;
        }

        .study-meta strong {
            margin-right: 5px;
            color: #444;
        }

        .study-meta a {
            color: #1976d2;
            text-decoration: none;
        }

        .study-meta a:hover {
            text-decoration: underline;
        }

        .abstract-toggle {
            background: none;
            border: none;
            color: #1976d2;
            cursor: pointer;
            padding: 5px 0;
            font-size: 14px;
            text-decoration: underline;
            margin-top: 10px;
        }

        .abstract-toggle:hover {
            color: #1565c0;
        }

        .abstract-content {
            margin-top: 10px;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 3px solid #1976d2;
            font-size: 14px;
            line-height: 1.6;
            display: none;
        }

        .abstract-content.show {
            display: block;
        }

        .citations {
            margin-top: 12px;
            font-size: 13px;
            color: #666;
        }

        .citation-link {
            color: #1976d2;
            cursor: pointer;
            text-decoration: underline;
        }

        .citation-link:hover {
            color: #1565c0;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .tag {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .tag.population {
            background-color: #f3e5f5;
            color: #7b1fa2;
        }

        .tag.method {
            background-color: #e8f5e9;
            color: #388e3c;
        }

        .tag.open-access {
            background-color: #fff3e0;
            color: #e65100;
            font-weight: 600;
        }

        .keywords {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
            font-size: 13px;
            color: #666;
        }

        .keywords strong {
            color: #444;
            margin-right: 5px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Curved Non-Motorized Treadmill Research Database</h1>
        <div class="description">
            This database contains research studies examining curved non-motorized treadmills and their applications in sports science, biomechanics, and exercise physiology. Use the filters below to search and sort studies by various criteria including population characteristics, research methods, treadmill specifications, and open access availability.
            <b>Note: This database is in active development and may not reflect ALL of the available studies.</b>
        </div>

        <button class="filter-toggle" onclick="toggleFilters()">
            Show/Hide Filters
        </button>
        
        <div class="filters" id="filterSection">
            <div class="filter-group">
                <label for="search">Search</label>
                <input type="text" id="search" placeholder="Search titles, authors...">
            </div>
            
            <div class="filter-group">
                <label for="methodFilter">Method</label>
                <select id="methodFilter">
                    <option value="">All Methods</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="minAge">Min Age</label>
                <input type="number" id="minAge" placeholder="Min" min="0" max="120">
            </div>
            
            <div class="filter-group">
                <label for="maxAge">Max Age</label>
                <input type="number" id="maxAge" placeholder="Max" min="0" max="120">
            </div>
            
            <div class="filter-group">
                <label for="sexFilter">Sex</label>
                <select id="sexFilter">
                    <option value="">All</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Treadmill Brand</label>
                <div class="checkbox-group" id="treadmillBrandCheckboxes"></div>
            </div>
            
            <div class="filter-group">
                <label for="openAccessFilter">Open Access</label>
                <select id="openAccessFilter">
                    <option value="">All</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="healthStatusFilter">Health Status</label>
                <select id="healthStatusFilter">
                    <option value="">All</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="treadmillFocusFilter">Treadmill Focus</label>
                <select id="treadmillFocusFilter">
                    <option value="">All</option>
                    <option value="Utility">Utility</option>
                    <option value="Focus">Focus</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="sortBy">Sort By</label>
                <select id="sortBy">
                    <option value="date-desc">Date (Newest First)</option>
                    <option value="date-asc">Date (Oldest First)</option>
                    <option value="title">Title (A-Z)</option>
                    <option value="author">First Author (A-Z)</option>
                </select>
            </div>

            <div class="filter-legend">
                <div class="legend-box legend-box-utility">
                    <div class="legend-title legend-title-utility">UTILITY</div>
                    <div class="legend-description">
                        The treadmill was used as a tool for data collection, but the study focus was not on the treadmill itself (e.g., measuring sprint performance, fatigue, or biomechanics where the treadmill is simply the measurement platform).
                    </div>
                </div>
                <div class="legend-box legend-box-focus">
                    <div class="legend-title legend-title-focus">FOCUS</div>
                    <div class="legend-description">
                        The treadmill itself was the primary subject of investigation (e.g., comparing curved vs. motorized treadmills, validating treadmill measurements, or studying treadmill-specific effects).
                    </div>
                </div>
            </div>
        </div>

        <div class="results-info">
            <span id="resultsCount">0 studies found</span>
            <button onclick="resetFilters()">Reset Filters</button>
        </div>

        <div id="studiesContainer"></div>
    </div>

    <script>
        let studiesData = [];
        let filteredStudies = [];

        // Load data from JSON file
        fetch('studies.json')
            .then(response => response.json())
            .then(data => {
                studiesData = data;
                filteredStudies = [...studiesData];
                populateFilters();
                filterAndSortStudies(); // Changed from displayStudies() to apply sorting
            })
            .catch(error => {
                console.error('Error loading studies:', error);
                document.getElementById('studiesContainer').innerHTML = 
                    '<div class="no-results">Error loading studies. Please make sure studies.json is in the same directory.</div>';
            });

        function toggleFilters() {
            const filterSection = document.getElementById('filterSection');
            const toggleButton = document.querySelector('.filter-toggle');
            filterSection.classList.toggle('collapsed');
            toggleButton.classList.toggle('collapsed');
        }

        function populateFilters() {
            const methods = new Set();
            const sexOptions = new Set();
            const healthStatuses = new Set();
            const treadmillBrands = new Set();

            studiesData.forEach(study => {
                study.methods.forEach(method => methods.add(method));
                sexOptions.add(study.population.sex);
                healthStatuses.add(study.population.healthStatus);
                if (study.treadmill) {
                    treadmillBrands.add(study.treadmill.brand);
                }
            });

            const methodFilter = document.getElementById('methodFilter');
            methods.forEach(method => {
                const option = document.createElement('option');
                option.value = method;
                option.textContent = method;
                methodFilter.appendChild(option);
            });

            const sexFilter = document.getElementById('sexFilter');
            Array.from(sexOptions).sort().forEach(sex => {
                const option = document.createElement('option');
                option.value = sex;
                option.textContent = sex;
                sexFilter.appendChild(option);
            });

            const treadmillBrandCheckboxes = document.getElementById('treadmillBrandCheckboxes');
            Array.from(treadmillBrands).sort().forEach(brand => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `brand-${brand}`;
                checkbox.value = brand;
                checkbox.addEventListener('change', filterAndSortStudies);
                
                const label = document.createElement('label');
                label.htmlFor = `brand-${brand}`;
                label.textContent = brand;
                
                div.appendChild(checkbox);
                div.appendChild(label);
                treadmillBrandCheckboxes.appendChild(div);
            });

            const healthStatusFilter = document.getElementById('healthStatusFilter');
            Array.from(healthStatuses).sort().forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                healthStatusFilter.appendChild(option);
            });
        }

        function filterAndSortStudies() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const methodFilter = document.getElementById('methodFilter').value;
            const minAge = document.getElementById('minAge').value;
            const maxAge = document.getElementById('maxAge').value;
            const sexFilter = document.getElementById('sexFilter').value;
            const openAccessFilter = document.getElementById('openAccessFilter').value;
            const healthStatusFilter = document.getElementById('healthStatusFilter').value;
            const treadmillFocusFilter = document.getElementById('treadmillFocusFilter').value;
            const sortBy = document.getElementById('sortBy').value;

            // Get selected treadmill brands
            const selectedBrands = Array.from(document.querySelectorAll('#treadmillBrandCheckboxes input:checked'))
                .map(cb => cb.value);

            filteredStudies = studiesData.filter(study => {
                const matchesSearch = searchTerm === '' || 
                    study.title.toLowerCase().includes(searchTerm) ||
                    study.authors.some(author => author.toLowerCase().includes(searchTerm)) ||
                    (study.keywords && study.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm)));
                
                const matchesMethod = methodFilter === '' || 
                    study.methods.includes(methodFilter);
                
                const matchesAge = (minAge === '' && maxAge === '') ||
                    (minAge === '' && study.population.ageLower <= parseInt(maxAge)) ||
                    (maxAge === '' && study.population.ageUpper >= parseInt(minAge)) ||
                    (minAge !== '' && maxAge !== '' && 
                     study.population.ageLower <= parseInt(maxAge) && 
                     study.population.ageUpper >= parseInt(minAge));

                const matchesSex = sexFilter === '' || 
                    study.population.sex === sexFilter;

                const matchesTreadmill = selectedBrands.length === 0 ||
                    (study.treadmill && selectedBrands.includes(study.treadmill.brand));

                const matchesOpenAccess = openAccessFilter === '' ||
                    (openAccessFilter === 'yes' && study.openAccess === true) ||
                    (openAccessFilter === 'no' && study.openAccess === false);

                const matchesHealthStatus = healthStatusFilter === '' || 
                    study.population.healthStatus === healthStatusFilter;

                const matchesTreadmillFocus = treadmillFocusFilter === '' ||
                    (study.treadmillFocus && study.treadmillFocus === treadmillFocusFilter);

                return matchesSearch && matchesMethod && matchesAge && matchesSex && matchesTreadmill && matchesOpenAccess && matchesHealthStatus && matchesTreadmillFocus;
            });

            filteredStudies.sort((a, b) => {
                switch(sortBy) {
                    case 'date-desc':
                        return b.year - a.year;
                    case 'date-asc':
                        return a.year - b.year;
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'author':
                        const lastNameA = a.authors[0].split(',')[0].trim();
                        const lastNameB = b.authors[0].split(',')[0].trim();
                        return lastNameA.localeCompare(lastNameB);
                    default:
                        return 0;
                }
            });

            displayStudies();
        }

        function formatCitation(studyId) {
            const study = studiesData.find(s => s.id === studyId);
            if (!study) return '';
            
            const authors = study.authors;
            const year = study.year;
            
            if (authors.length === 1) {
                const lastName = authors[0].split(',')[0];
                return `${lastName} (${year})`;
            } else if (authors.length === 2) {
                const lastName1 = authors[0].split(',')[0];
                const lastName2 = authors[1].split(',')[0];
                return `${lastName1} & ${lastName2} (${year})`;
            } else {
                const lastName = authors[0].split(',')[0];
                return `${lastName} et al. (${year})`;
            }
        }

        function displayStudies() {
            const container = document.getElementById('studiesContainer');
            const resultsCount = document.getElementById('resultsCount');
            
            resultsCount.textContent = `${filteredStudies.length} ${filteredStudies.length === 1 ? 'study' : 'studies'} found`;

            if (filteredStudies.length === 0) {
                container.innerHTML = '<div class="no-results">No studies match your filters</div>';
                return;
            }

            container.innerHTML = filteredStudies.map(study => {
                const citedBy = studiesData.filter(s => s.citations.includes(study.id));
                const citedByText = citedBy.length > 0 
                    ? `Cited by: ${citedBy.map(s => `<span class="citation-link" onclick="filterByCitation('${s.id}')">${formatCitation(s.id)}</span>`).join(', ')}`
                    : '';

                const citesText = study.citations.length > 0
                    ? `Cites: ${study.citations.map(id => `<span class="citation-link" onclick="filterByCitation('${id}')">${formatCitation(id)}</span>`).filter(Boolean).join(', ')}`
                    : '';

                const doiLink = study.DOI ? `<span><strong>DOI:</strong> <a href="https://doi.org/${study.DOI}" target="_blank" rel="noopener noreferrer">${study.DOI}</a></span>` : '';

                const focusClass = study.treadmillFocus && study.treadmillFocus.toLowerCase() !== 'unknown' 
                    ? study.treadmillFocus.toLowerCase() 
                    : '';
                
                const focusBadge = study.treadmillFocus && study.treadmillFocus.toLowerCase() !== 'unknown'
                    ? `<div class="treadmill-focus-badge ${study.treadmillFocus.toLowerCase()}">${study.treadmillFocus}</div>`
                    : '';

                return `
                <div class="study-card ${focusClass}" id="study-${study.id}">
                    ${focusBadge}
                    <div class="study-id">ID: ${study.id}</div>
                    <div class="study-title">${study.title}</div>
                    <div class="study-authors">${study.authors.join(', ')}</div>
                    <div class="study-meta">
                        <span><strong>Year:</strong> ${study.year}</span>
                        <span><strong>Journal:</strong> ${study.journal}</span>
                        <span><strong>Sample Size:</strong> ${study.sampleSize}</span>
                        ${study.treadmill ? `<span><strong>Treadmill:</strong> ${study.treadmill.brand} ${study.treadmill.model}</span>` : ''}
                        ${doiLink}
                    </div>
                    <div><strong>Key Findings:</strong> ${study.keyFindings}</div>
                    <button class="abstract-toggle" onclick="toggleAbstract('${study.id}')">Show Abstract</button>
                    <div class="abstract-content" id="abstract-${study.id}">
                        ${study.abstract}
                    </div>
                    ${citesText ? `<div class="citations">${citesText}</div>` : ''}
                    ${citedByText ? `<div class="citations">${citedByText}</div>` : ''}
                    <div class="tags">
                        <span class="tag population">Ages ${study.population.ageLower}-${study.population.ageUpper}</span>
                        <span class="tag population">${study.population.sex}</span>
                        <span class="tag population">${study.population.healthStatus}</span>
                        ${study.methods.map(method => `<span class="tag method">${method}</span>`).join('')}
                        ${study.openAccess ? '<span class="tag open-access">ðŸ”“ Open Access</span>' : ''}
                    </div>
                    ${study.keywords && study.keywords.length > 0 ? `
                    <div class="keywords">
                        <strong>Keywords:</strong> ${study.keywords.join(', ')}
                    </div>
                    ` : ''}
                </div>
            `;
            }).join('');
        }

        function toggleAbstract(studyId) {
            const abstractDiv = document.getElementById(`abstract-${studyId}`);
            const button = abstractDiv.previousElementSibling;
            
            if (abstractDiv.classList.contains('show')) {
                abstractDiv.classList.remove('show');
                button.textContent = 'Show Abstract';
            } else {
                abstractDiv.classList.add('show');
                button.textContent = 'Hide Abstract';
            }
        }

        function filterByCitation(studyId) {
            document.getElementById('search').value = '';
            document.getElementById('methodFilter').value = '';
            document.getElementById('minAge').value = '';
            document.getElementById('maxAge').value = '';
            document.getElementById('sexFilter').value = '';
            document.getElementById('openAccessFilter').value = '';
            document.getElementById('healthStatusFilter').value = '';
            document.querySelectorAll('#treadmillBrandCheckboxes input').forEach(cb => cb.checked = false);
            
            filteredStudies = studiesData.filter(study => study.id === studyId);
            displayStudies();
            
            setTimeout(() => {
                document.getElementById(`study-${studyId}`).scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function resetFilters() {
            document.getElementById('search').value = '';
            document.getElementById('methodFilter').value = '';
            document.getElementById('minAge').value = '';
            document.getElementById('maxAge').value = '';
            document.getElementById('sexFilter').value = '';
            document.getElementById('openAccessFilter').value = '';
            document.getElementById('healthStatusFilter').value = '';
            document.getElementById('treadmillFocusFilter').value = '';
            document.getElementById('sortBy').value = 'date-desc';
            document.querySelectorAll('#treadmillBrandCheckboxes input').forEach(cb => cb.checked = false);
            filterAndSortStudies();
        }

        document.getElementById('search').addEventListener('input', filterAndSortStudies);
        document.getElementById('methodFilter').addEventListener('change', filterAndSortStudies);
        document.getElementById('minAge').addEventListener('input', filterAndSortStudies);
        document.getElementById('maxAge').addEventListener('input', filterAndSortStudies);
        document.getElementById('sexFilter').addEventListener('change', filterAndSortStudies);
        document.getElementById('openAccessFilter').addEventListener('change', filterAndSortStudies);
        document.getElementById('healthStatusFilter').addEventListener('change', filterAndSortStudies);
        document.getElementById('treadmillFocusFilter').addEventListener('change', filterAndSortStudies);
        document.getElementById('sortBy').addEventListener('change', filterAndSortStudies);
    </script>
</body>
</html>